---
import { Icon } from "astro-icon/components";
import { type CollectionEntry, getEntry, render } from "astro:content";
import MyPicture from "./MyPicture.astro";
import TestimonialHelper from "./TestimonialHelper";

interface Props {
  testimonial: CollectionEntry<"testimonials">;
}

const { testimonial } = Astro.props,
  { Content } = await render(testimonial),
  { profile, location, name, photo, company: _company } = testimonial.data,
  company = {
    ..._company,
    entity: (await getEntry(_company.entity)).data,
  };
---

<TestimonialHelper {company} {location} {name} {profile}>
  <Content />
  <MyPicture
    src={photo}
    alt={name}
    quality="low"
    class="mx-auto size-20 rounded-full shadow-lg"
    slot="photo"
  />
  <Icon
    name=`companies/${company.entity.id}`
    title={company.entity.name}
    width={158}
    height={48}
    class="mx-auto h-12"
    slot="companyLogo"
  />
</TestimonialHelper>
