---
import { getCollection, getEntry } from "astro:content";
import Base from "../../layouts/Base.astro";
import ArticleLinks from "../../components/ArticleLinks.astro";
import AuthorWide from "../../components/AuthorWide.astro";
import FullContainer from "../../containers/FullContainer";

export async function getStaticPaths() {
  const articles = await getCollection("articles");
  const authors = await getCollection("authors");
  // const authors = [
  //   ...new Set(articles.map((article) => article.data.author)),
  // ];
  return authors.map((author) => {
    const filteredArticles = articles.filter(
      (article) => article.data.author.id === author.id,
    );
    return {
      params: { author: author.id },
      props: { articles: filteredArticles },
    };
  });
}

const { author } = Astro.params;
const { articles } = Astro.props;
const author2 = await getEntry("authors", author);
const authorName = author2.data.name;
const description = `Articles written by ${authorName}`;
---

<Base title={authorName} {description}>
  <FullContainer>
    <AuthorWide author={author2} />
    <h1>Articles written by {authorName}</h1>
    <ArticleLinks {articles} />
  </FullContainer>
</Base>
