---
import Photo from "@/assets/images/latest/videos.png";
import MyPicture from "@/components/MyPicture.astro";
import site from "@/data/site.json";
import { youtube } from "@googleapis/youtube";
import { YOUTUBE_API_KEY } from "astro:env/server";

interface YoutubeVideo {
  id: {
    videoId: string;
  };
  snippet: {
    title: string;
  };
}

interface YoutubeResponse {
  data: {
    items: YoutubeVideo[];
  };
}

const youtubeHandler = youtube({
  version: "v3",
  auth: YOUTUBE_API_KEY,
});

const params = {
  part: "snippet",
  channelId: "UCRS4DvO9X7qaqVYUW2_dwOw",
  maxResults: 6,
  order: "date",
};

const {
  data: { items },
}: YoutubeResponse = await youtubeHandler.search.list(params);
const latestVideos = items.map(({ id: { videoId }, snippet: { title } }) => ({
  title,
  url: `https://www.youtube.com/watch?v=${videoId}`,
}));
---

<div class="rounded-3xl">
  <div
    class="card-shadow card-shadow-color overflow-hidden rounded-3xl bg-secondary"
  >
    <div class="max-h-40 w-full max-w-7xl overflow-hidden">
      <a href={site.socials.youtube.url}>
        <MyPicture
          src={Photo}
          alt="videos thumbnail"
          quality="mid"
          class="object-cover object-center"
        />
      </a>
    </div>
    <div class="mx-auto mb-4 max-w-7xl">
      <div class="mx-auto">
        <a href={} class="no-underline hover:no-underline">
          <h3
            class="my-4 text-center text-3xl font-bold tracking-tight text-content hover:text-accent-2 sm:text-4xl"
          >
            Latest Videos
          </h3>
        </a>
        <div class="py-4 sm:py-4">
          {
            latestVideos.map(async ({ title, url }) => (
              <Fragment>
                <article class="max-w-full hover:bg-primary hover:text-content-2">
                  <div class="group relative mx-auto">
                    <h4 class="article-home-link mx-auto my-1 px-4 py-2.5 text-center text-lg font-normal leading-6 text-content no-underline group-hover:text-content-2">
                      <a
                        href={url}
                        class="text-content no-underline hover:no-underline group-hover:text-content-2"
                      >
                        <span class="absolute inset-0" />
                        {title}
                      </a>
                    </h4>
                  </div>
                </article>
              </Fragment>
            ))
          }
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  article:hover h3 {
    color: white !important;
  }
</style>
